#!/bin/sh

## ==== FAILS

## Get an authorisation token from Azure using the authorisation code flow


curl https://login.microsoftonline.com/4395f4a7-e455-4f95-8a9f-1fbaef6384f9/oauth2/v2.0/authorize?client_id=a462354f-fd23-4fdf-94f5-5cce5a6c27c7&response_type=code&redirect_uri=https%3A%2F%2Flogin.microsoftonline.com%2Fcommon%2Foauth2%2Fnativeclient&response_mode=query&scope=Calendars.Read

## Notes

## See here for Microsoft Graph documentation:
## https://docs.microsoft.com/en-us/graph/

## See here for useful information about this specific app in the Turing AD:
## https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Overview/appId/a462354f-fd23-4fdf-94f5-5cce5a6c27c7/objectId/a8270fdf-7795-4d94-a178-1755bf8613bf/isMSAApp/

## 4395f4a7-e455-4f95-8a9f-1fbaef6384f9 is the GUID for our AD "tenant"
## A "tenant" is (I believe) Microsoft's name for an instance of AD.


## ==== SUCCEEDS!

## Authorise using the device code flow
## Note the Microsoft's documentation lies to some extent: the URL is as below, not ../devicecode as on
## https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code

## Ask user to sign in

curl -v -d 'client_id=a462354f-fd23-4fdf-94f5-5cce5a6c27c7&scope=Bookings.Read.All%20offline_access' https://login.microsoftonline.com/4395f4a7-e455-4f95-8a9f-1fbaef6384f9/oauth2/v2.0/devicecode

## Get token (replace device_code with the appropriate value!)

curl -v -d 'client_id=a462354f-fd23-4fdf-94f5-5cce5a6c27c7&grant_type=urn:ietf:params:oauth:grant-type:device_code&device_code=DAQABAAEAAADCoMpjJXrxTq9VG9te-7FXwE9GoOxztnD8UJUpEehBBcUWbWa-35cnHYrQ0xgLy2QCb_eLCBwRRopHeV-09Ppo6GCAsOOAL2Zf8T1k2yrWzMnrsDYzB0pwg-AnYVao4RVHo-Gb_SuzA-8MMo1-a-Yso3lMTDgWgCJn71PkSSWv0CAA' https://login.microsoftonline.com/4395f4a7-e455-4f95-8a9f-1fbaef6384f9/oauth2/v2.0/token


## ==== GET SOME DATA

curl -v --header "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25jZSI6IkFRQUJBQUFBQUFEQ29NcGpKWHJ4VHE5Vkc5dGUtN0ZYS0tKbWxwN1pOUHVfMVRIQUM2V2ZuVk1LNmZSeVpSWHhUY2d6dFBkck4zMkVkZ3J1SDVlTmp3WmFRZjgxc1VxZHVnc3dnSXI5MWNDSnBraFNON0cyWmlBQSIsImFsZyI6IlJTMjU2IiwieDV0IjoiSEJ4bDltQWU2Z3hhdkNrY29PVTJUSHNETmEwIiwia2lkIjoiSEJ4bDltQWU2Z3hhdkNrY29PVTJUSHNETmEwIn0.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC80Mzk1ZjRhNy1lNDU1LTRmOTUtOGE5Zi0xZmJhZWY2Mzg0ZjkvIiwiaWF0IjoxNTU3MzE3NzUwLCJuYmYiOjE1NTczMTc3NTAsImV4cCI6MTU1NzMyMTY1MCwiYWNjdCI6MCwiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhMQUFBQWs4Ylp4WWdBMklhUTFmODhmWTQyL3F2TXFYV3lhcjlnMzZHU3NrZVpZUTNyMENWa0dlNGgrVU0rNUVtMVZXelJZL1lPTTdtNUNwQ1VnSXB0V005ZVBmNkJSc1FnUW1IN3JQU3hwZUUrYlVrPSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwX2Rpc3BsYXluYW1lIjoiTWVldGluZyBSb29tIEF2YWlsYWJpbGl0eSBDaGVja2VyIiwiYXBwaWQiOiJhNDYyMzU0Zi1mZDIzLTRmZGYtOTRmNS01Y2NlNWE2YzI3YzciLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6IkdlZGRlcyIsImdpdmVuX25hbWUiOiJKYW1lcyIsImlwYWRkciI6IjE5My42MC4yMjAuMjUzIiwibmFtZSI6IkphbWVzIEdlZGRlcyIsIm9pZCI6ImE1OGY4YmNmLWM0MTUtNDJjMS1iNDFkLWE4NTU3MWYxYmIzYyIsIm9ucHJlbV9zaWQiOiJTLTEtNS0yMS0xNTIzMTI5NDQwLTMxMDgxMTY1ODctMjI2NTAzNTY1OC0xNDg4IiwicGxhdGYiOiIxNCIsInB1aWQiOiIxMDAzM0ZGRjk3MTQ5OTQyIiwic2NwIjoiQ2FsZW5kYXJzLlJlYWQuU2hhcmVkIFVzZXIuUmVhZCBwcm9maWxlIG9wZW5pZCBlbWFpbCIsInNpZ25pbl9zdGF0ZSI6WyJrbXNpIl0sInN1YiI6Inl0TWR4al9QWjJPM0FCTTVWVzlxLXZVdkwzWmdsTUdsSmNleVlYblpNY2MiLCJ0aWQiOiI0Mzk1ZjRhNy1lNDU1LTRmOTUtOGE5Zi0xZmJhZWY2Mzg0ZjkiLCJ1bmlxdWVfbmFtZSI6ImpnZWRkZXNAdHVyaW5nLmFjLnVrIiwidXBuIjoiamdlZGRlc0B0dXJpbmcuYWMudWsiLCJ1dGkiOiJoZkR4b2pVWlhrZWRITE4xRS1tTkFBIiwidmVyIjoiMS4wIiwieG1zX3N0Ijp7InN1YiI6IlRTVHhpczg4Qnp5UW9BcV9FR3puZ3hfa05IMzBVam8zT3NRSmZpbmZ1akEifSwieG1zX3RjZHQiOjE0MzgwOTczNTl9.wrjYG8k6XdxBNpuDmPN8N32mJGGtUWY6sfOdsE15O6hdTNb5ply5hlI_mXGhsVoQCAdHyctIUzOw_qhC4ob-fkuXmHHZCOEt3yUrbDw6X8X_L0_pvzatZu5wgGT6mPwdQ5FimWvL9ZMBA5_mcbEOYvUEzSpBXMYPmWPmWOzeoAgOWh4RJpCS2P9oxNtbH_RI-5Cg0xy6Xqpx77WVaDVI_9pQl8ym_7JXYBkr3AWBrKFLy3dE832rU3qFvb3OzsvAi3rp5v1cBp4ObCZKxF7nX2jqLknrg77xfoJFWLqR2DEwnO06owyH0PUixGMZWVFx2Y44j8v4L87uuMea5O23_w" https://graph.microsoft.com/v1.0/me/

curl -v --request POST \
     --url https://graph.microsoft.com/v1.0/me/calendar/getschedule \
     --header 'Prefer: outlook.timezone="Europe/London"' \
  --header 'authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25jZSI6IkFRQUJBQUFBQUFEQ29NcGpKWHJ4VHE5Vkc5dGUtN0ZYcnoyWVRnZ0d3ZjRzQjZETVhKU0NFWjFpN0o5VGo0MUh4Y29faEF1cjB0SFBSMzc2OC1MdlpEMWhmdklQV3d2LXBGbGNaQUpDUk9pRmRjZlJqUnhtVENBQSIsImFsZyI6IlJTMjU2IiwieDV0IjoiSEJ4bDltQWU2Z3hhdkNrY29PVTJUSHNETmEwIiwia2lkIjoiSEJ4bDltQWU2Z3hhdkNrY29PVTJUSHNETmEwIn0.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC80Mzk1ZjRhNy1lNDU1LTRmOTUtOGE5Zi0xZmJhZWY2Mzg0ZjkvIiwiaWF0IjoxNTU3MzI0MTA0LCJuYmYiOjE1NTczMjQxMDQsImV4cCI6MTU1NzMyODAwNCwiYWNjdCI6MCwiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhMQUFBQWxKV1E4eEtReGlUbndVYmt1emhyMU5QdEl5T3ZiQi81UUttZlh2Z3ViT2l5aTJEbmk5ZENtb0RRMWdpOURwc0lJWkZGM0RoYlRmZ2N5eTJ5eXpuVUlITUNRV1o0L3h6QmFPQWEreUFQS08wPSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwX2Rpc3BsYXluYW1lIjoiTWVldGluZyBSb29tIEF2YWlsYWJpbGl0eSBDaGVja2VyIiwiYXBwaWQiOiJhNDYyMzU0Zi1mZDIzLTRmZGYtOTRmNS01Y2NlNWE2YzI3YzciLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6IkdlZGRlcyIsImdpdmVuX25hbWUiOiJKYW1lcyIsImlwYWRkciI6IjE5My42MC4yMjAuMjQwIiwibmFtZSI6IkphbWVzIEdlZGRlcyIsIm9pZCI6ImE1OGY4YmNmLWM0MTUtNDJjMS1iNDFkLWE4NTU3MWYxYmIzYyIsIm9ucHJlbV9zaWQiOiJTLTEtNS0yMS0xNTIzMTI5NDQwLTMxMDgxMTY1ODctMjI2NTAzNTY1OC0xNDg4IiwicGxhdGYiOiIxNCIsInB1aWQiOiIxMDAzM0ZGRjk3MTQ5OTQyIiwic2NwIjoiQ2FsZW5kYXJzLlJlYWQuU2hhcmVkIFVzZXIuUmVhZCBwcm9maWxlIG9wZW5pZCBlbWFpbCIsInNpZ25pbl9zdGF0ZSI6WyJrbXNpIl0sInN1YiI6Inl0TWR4al9QWjJPM0FCTTVWVzlxLXZVdkwzWmdsTUdsSmNleVlYblpNY2MiLCJ0aWQiOiI0Mzk1ZjRhNy1lNDU1LTRmOTUtOGE5Zi0xZmJhZWY2Mzg0ZjkiLCJ1bmlxdWVfbmFtZSI6ImpnZWRkZXNAdHVyaW5nLmFjLnVrIiwidXBuIjoiamdlZGRlc0B0dXJpbmcuYWMudWsiLCJ1dGkiOiJIZ0dmUUJncGUwQzZDUHo5OGdTVkFBIiwidmVyIjoiMS4wIiwieG1zX3N0Ijp7InN1YiI6IlRTVHhpczg4Qnp5UW9BcV9FR3puZ3hfa05IMzBVam8zT3NRSmZpbmZ1akEifSwieG1zX3RjZHQiOjE0MzgwOTczNTl9.F4gmZtf0b3SiKduCoXm8CYsVeEu-IOBcHp7oLXxPJX6pEozFWva06ie6SVR07cRVqwYU-4-t96sVATeUre-MM9sPHVBZaff4tyDoRZzIWkQ494v8K9c1kPWCbVmMShOUBnh1oytmua946JaYuENdj5ZBS05gQicf5o00IBIi78GHrsP77CdizMQGmLCOiHiLJmVyLjXyq85t8AelM2d6ayst5huX3bOsyZgYTcFy_VLweEW-7ZAZEE9-TH46t5FqMy5l7aiBQtAy_Gakfmiw7sMvHiOy6BueCwgsvr478cwgGxRnWhGM0rs3TD-m9Vuso6Vh5Gex8mQ19REQjk74Sw' \
  --header 'content-type: application/json' \
  --data '{
  "Schedules": [
    "davidblackwell@turing.ac.uk",
    "jackgood@turing.ac.uk"
  ],
  "StartTime": {
    "dateTime": "2019-05-08T07:00:00",
    "timeZone": "GMT"
  },
  "EndTime": {
    "dateTime": "2019-05-08T18:00:00",
    "timeZone": "GMT"
  },
  "availabilityViewInterval": "30"
}'
